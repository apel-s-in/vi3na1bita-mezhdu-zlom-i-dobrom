<!DOCTYPE html>
<html lang="ru">
<head>
  <meta charset="UTF-8" />
  <title>–í–∏—Ç—Ä–∏–Ω–∞ –†–∞–∑–±–∏—Ç–∞</title>
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <style>
    body {
      background:#181818;color:#f2f2f2;font-family:sans-serif;margin:0;padding:0;
      min-height:100vh;display:flex;flex-direction:column;
    }
    header {background:none; text-align:center; padding-bottom:0;}
    #cover-wrap {
      width: 100%; max-width: 400px; margin: 24px auto 0 auto;
      aspect-ratio: 1/1; display: flex; align-items: center; justify-content: center; position: relative;
    }
    .cover-gallery-arrow {
      position: absolute; top: 50%; transform: translateY(-50%);
      font-size: 2.3em; color: #fff; background: rgba(0,0,0,0.22); border: none;
      border-radius: 50%; width: 44px; height: 44px;
      display: flex; align-items: center; justify-content: center;
      cursor: pointer; z-index: 2; transition: background .16s;
    }
    .cover-gallery-arrow:hover {background: rgba(60,60,120,0.40);}
    #cover-gallery-arrow-left {left: 7px;}
    #cover-gallery-arrow-right {right: 7px;}
    #cover {
      width: 100%; height: auto; max-width: 100%; border-radius: 12px; aspect-ratio: 1/1;
      object-fit: cover; display: block; margin: 0; box-shadow: 0 6px 32px #000a;
      background:#202020; transition: filter .2s; pointer-events: none; user-drag: none; -webkit-user-drag: none; user-select: none;
    }
    .socials-under-cover {
      margin: 12px auto 0 auto;text      color:#4daaff; background: none; border: none; padding:0 7px; cursor:pointer;
      font-size:1em; text-transform:uppercase; font-weight:700; letter-spacing:.03em;
      text-decoration:underline; transition:color .18s
    }
    .karaoke-btn:focus,.karaoke-btn:hover {color:#fff;}
    #audio {width:100%;margin:6px auto 2px auto;display:block;max-width:398px;}
    .feedback-support-row {
      max-width:400px; margin:16px auto 0 auto;display:flex;justify-content:space-between;
      gap:16px; font-size:1em;
    }
    .feedback-link, .support-link {
      color:#4daaff; text-decoration:underline;
      font-weight:700; text-transform:uppercase;
      letter-spacing:.03em; cursor:pointer; transition:color.18s;
      font-size:1em;
    }
    .feedback-link:hover,.support-link:hover {color:#fff;}
    .logo-bottom {
      display:block; margin:26px auto 24px auto; max-width:110px;
      width:23vw; min-width:64px; height:auto;
      filter:drop-shadow(0 1px 14px #041C);
    }
    /* feedback modal */
    .modal-bg {
      position: fixed; z-index:99; left:0;top:0;right:0;bottom:0;
      background:rgba(0,0,0,0.62); display:none;align-items:center;justify-content:center;
    }
    .modal-bg.active {display:flex;}
    .modal-feedback {
      background:#18181a; border-radius:14px; padding:28px 20px 22px 20px; width:94vw; max-width:340px;
      box-shadow:0 0 18px #222; color:#eee; text-align:center; position:relative;
    }
    .modal-feedback textarea {
      width:100%; min-height:76px; max-height:160px; border-radius:8px; border:1px solid #aaa;
      padding:14px 12px; font-size:1em; margin:12px 0 10px 0; background:#202022;
      color:#fff; resize:none;outline:none;transition:border .12s;
    }
    .modal-feedback textarea::placeholder {color:#bbb;}
    .modal-feedback .close-modal {
      position:absolute; right:8px;top:8px; color:#aaa; font-size:1.44em; background:none; border:none; cursor:pointer;
    }
    .modal-feedback button {
      background:#4daaff; color:#fff; border:none; border-radius:7px; font-size:1em; font-weight:700;
      padding:7px 18px; cursor:pointer; margin-top:7px; transition:background .18s;
    }
    .modal-feedback button:disabled {background:#2c4c68; color:#999;cursor:not-allowed;}
    .modal-feedback .desc {font-size:.96em;color:#aaa;margin-bottom:6px;}
    .modal-feedback .success-msg {color:#47ec92;font-size:.98em;margin:7px 0 2px 0;}
    .modal-feedback .err-msg {color:#fa4949;font-size:.96em;}
    @media (max-width:430px) {
      #cover-wrap, .socials-under-cover, .track-list, #lyrics-window {max-width:94vw;}
      #cover {border-radius:8px;}
      .logo-bottom {max-width:75px;}
      .lyrics-window-line {font-size:1em;}
      #audio {max-width:99vw;}
      .feedback-support-row {max-width:96vw;}
    }
  </style>
</head>
<body>
  <div id="promocode-block">
    <h2>–í—Ö–æ–¥ –ø–æ –ø—Ä–æ–º–æ–∫–æ–¥—É</h2>
    <input id="promo-inp" type="text" placeholder="–í–≤–µ–¥–∏—Ç–µ –ø—Ä–æ–º–æ–∫–æ–¥" autofocus />
    <button onclick="checkPromo()">–í–æ–π—Ç–∏</button>
    <div id="promo-error" style="color:red;margin:10px;"></div>
  </div>
  <div id="main-block" class="hidden" style="flex:1 1 auto;">
    <header>
      <div id="cover-wrap">
        <button class="cover-gallery-arrow" id="cover-gallery-arrow-left" title="–ù–∞–∑–∞–¥">&#8592;</button>
        <img id="cover" src="Cover.png" alt="Cover album" draggable="false"/>
        <button class="cover-gallery-arrow" id="cover-gallery-arrow-right" title="–í–ø–µ—Ä—ë–¥">&#8594;</button>
      </div>
      <div id="social-links" class="socials-under-cover"></div>
    </header>
    <div class="track-list" id="track-list"></div>
    <div class="feedback-support-row">
      <span class="feedback-link" id="feedback-link">–û–±—Ä–∞—Ç–Ω–∞—è —Å–≤—è–∑—å</span>
      <a class="support-link" id="support-link" href="#" target="_blank">–ü–æ–¥–¥–µ—Ä–∂–∞—Ç—å</a>
    </div>
    <img class="logo-bottom" src="Logo.png" alt="–õ–æ–≥–æ—Ç–∏–ø"/>
  </div>
  <!-- –ú–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ –æ–±—Ä–∞—Ç–Ω–æ–π —Å–≤—è–∑–∏ -->
  <div class="modal-bg" id="modal-feedback">
    <div class="modal-feedback">
      <button class="close-modal" onclick="closeFeedbackModal()" title="–ó–∞–∫—Ä—ã—Ç—å">&times;</button>
      <div class="desc">–û–ø–∏—à–∏—Ç–µ –∑–¥–µ—Å—å –ø—Ä–æ–±–ª–µ–º—É –∏–ª–∏ —Å–≤–æ—ë –ø–æ–∂–µ–ª–∞–Ω–∏–µ –¥–ª—è —É–ª—É—á—à–µ–Ω–∏—è,<br> –º–æ–∂–µ—Ç–µ –ø—Ä–æ—Å—Ç–æ –æ—Å—Ç–∞–≤–∏—Ç—å —Å–≤–æ–π –æ—Ç–∑—ã–≤</div>
      <textarea id="feedback-text" maxlength="200" placeholder="–í–∞—à–µ —Å–æ–æ–±—â–µ–Ω–∏–µ..."></textarea>
      <div id="modal-feedback-error" class="err-msg"></div>
      <div id="modal-feedback-success" class="success-msg"></div>
      <button onclick="sendFeedbackMsg()" id="send-feedback-btn">–û—Ç–ø—Ä–∞–≤–∏—Ç—å</button>
    </div>
  </div>
  <script>
    // ---------- –ì–∞–ª–µ—Ä–µ—è ----------
    const coverGalleryArr = ['Cover.png', 'Cover01.png', 'Cover02.png', 'Cover03.png'];
    let coverGalleryIdx = 0, coverAutoplay = null;
    // Telegram Feedback config!
    const tgBotToken = '--- INSERT TOKEN HERE ---'; // <-- –≤—Å—Ç–∞–≤—å—Ç–µ —Ä–µ–∞–ª—å–Ω–æ —Å—é–¥–∞!
    const tgUserId = '--- INSERT ADMIN USER ID HERE ---'; // <-- –≤–∞—à Telegram user_id. (—Å–º. –Ω–∏–∂–µ –≤ –∏–Ω—Å—Ç—Ä—É–∫—Ü–∏–∏)
    //const tgUsername = '@AI7eJIbCuH'; // –Ω–µ –Ω—É–∂–µ–Ω –¥–ª—è –æ—Ç–ø—Ä–∞–≤–∫–∏, –æ—Å—Ç–∞–≤–ª–µ–Ω–æ —Ç–æ–ª—å–∫–æ –¥–ª—è –∏—Å—Ç–æ—Ä–∏–∏

    let config, currentTrack = 0, currentLyrics = [], promoPassed = false;

    fetch('config.json').then(r => r.json()).then(data => {
      config = data;
      setCoverImage(coverGalleryIdx); // –ü–µ—Ä–≤–∞—è –∫–∞—Ä—Ç–∏–Ω–∫–∞
      buildSocials();
      // Support-—Å—Å—ã–ª–∫–∞
      document.getElementById('support-link').href = config.donateLink;
      document.body.style.background = "url(" + config.background + ") center/cover fixed #111";
      buildTrackList();
      showTrack(0);
      startCoverAutoPlay();
    });

    // ------ –ì–∞–ª–µ—Ä–µ—è -----
    function setCoverImage(idx) {
      coverGalleryIdx = (idx + coverGalleryArr.length) % coverGalleryArr.length;
      document.getElementById('cover').src = coverGalleryArr[coverGalleryIdx];
    }
    function startCoverAutoPlay() {
      if(coverAutoplay) clearInterval(coverAutoplay);
      coverAutoplay = setInterval(function(){
        setCoverImage(coverGalleryIdx + 1);
      }, 5000);
    }
    document.addEventListener('DOMContentLoaded', function(){
      document.getElementById('cover-gallery-arrow-left').onclick = function(e){
        setCoverImage(coverGalleryIdx - 1);
        startCoverAutoPlay();
      };
      document.getElementById('cover-gallery-arrow-right').onclick = function(e){
        setCoverImage(coverGalleryIdx + 1);
        startCoverAutoPlay();
      };
      // –ú–æ–±–∏–ª—å–Ω—ã–π —Å–≤–∞–π–ø
      let startX = null;
      const el = document.getElementById('cover-wrap');
      el.addEventListener('touchstart', function(e) {
        startX = e.touches[0].clientX;
      });
      el.addEventListener('touchend', function(e) {
        if(startX===null) return;
        let dx = e.changedTouches[0].clientX - startX;
        if(Math.abs(dx) > 30) {
          if(dx > 0) setCoverImage(coverGalleryIdx - 1);
          else setCoverImage(coverGalleryIdx + 1);
          startCoverAutoPlay();
        }
        startX = null;
      });
    });

    function checkPromo() {
      const val = document.getElementById('promo-inp').value.trim();
      if(val && config && val.toUpperCase() === config.promoCode.toUpperCase()) {
        document.getElementById('main-block').classList.remove('hidden');
        document.getElementById('promocode-block').classList.add('hidden');
        promoPassed = true;
      } else {
        document.getElementById('promo-error').innerText = "–ù–µ–≤–µ—Ä–Ω—ã–π –ø—Ä–æ–º–æ–∫–æ–¥. –ü–æ–ø—Ä–æ–±—É–π—Ç–µ –µ—â—ë!";
      }
    }
    function buildSocials() {
      const s = config.socials.map(x =>
        `<a href="${x.url}" target="_blank">${x.title}</a>`
      ).join(" ");
      document.getElementById('social-links').innerHTML = s;
    }

    function buildTrackList() {
      let html = "";
      for (let i = 0; i < config.tracks.length; i++) {
        html += `<div class="track${i===currentTrack?' current':''}" id="trk${i}" onclick="showTrack(${i})">
          <span class="tnum">${(i+1).toString().padStart(2,'0')}.</span>${config.tracks[i].title}</div>`;
        if (i === currentTrack) html += `
    <div class="lyrics-player-block" id="lyricsplayerblock"></div>
        `;
      }
      document.getElementById('track-list').innerHTML = html;
      renderLyricsBlock();
    }

    function renderLyricsBlock() {
      const block = document.getElementById('lyricsplayerblock');
      if(!block) return;
      let lyricsDiv = `
<div id="lyrics-window"><div class="lyrics-scroll" id="lyrics"></div></div>
<audio id="audio" controls preload="metadata"></audio>
<div class="karaoke-controls">
  <a class="karaoke-btn" id="download-link" href="#" download>–°–∫–∞—á–∞—Ç—å –ø–µ—Å–Ω—é</a>
  <button class="karaoke-btn" onclick="copyLyrics()">–°–∫–æ–ø–∏—Ä–æ–≤–∞—Ç—å —Ç–µ–∫—Å—Ç</button>
</div>`;
      block.innerHTML = lyricsDiv;
      const tr = config.tracks[currentTrack];
      document.getElementById('audio').src = tr.audio;
      document.getElementById('download-link').href = tr.audio;
      loadLyrics(tr.lyrics);
      document.getElementById('audio').ontimeupdate = function () {
        renderLyrics(this.currentTime);
      };
      setTimeout(()=>{
        const audio = document.getElementById('audio');
        audio.currentTime = 0;
        let playPromise = audio.play();
        if(playPromise) playPromise.catch(()=>{});
      },250);
      document.getElementById('audio').onended = function () {
        let next = (currentTrack + 1) % config.tracks.length;
        showTrack(next);
      };
    }

    function loadLyrics(file) {
      fetch(file).then(r=>r.json()).then(js => {
        currentLyrics = js;
        renderLyrics(0);
      });
    }

    function renderLyrics(time) {
      if (!currentLyrics || !currentLyrics.length) {
        document.getElementById('lyrics').innerHTML = "";
        return;
      }
      let active = 0;
      for (let i = 0; i < currentLyrics.length; i++) {
        if (time >= currentLyrics[i].time) active = i;
      }
      let windowSize = 5;
      let start = active < 2 ? 0 : active - 2;
      let padTop = active < 2 ? 2-active : 0;
      let padBot = 0;
      let rows = [];
      for(let p=0; p<padTop; ++p) rows.push('<div class="lyrics-window-line"></div>');
      for(let i=start; i<Math.min(currentLyrics.length, start+windowSize-padTop); i++) {
        let cls = (i===active) ? 'lyrics-window-line active' : 'lyrics-window-line';
        rows.push(`<div class="${cls}">${currentLyrics[i]?currentLyrics[i].line:""}</div>`);
      }
      while(rows.length<windowSize) rows.push('<div class="lyrics-window-line"></div>');
      document.getElementById("lyrics").innerHTML = rows.join("");
    }

    function showTrack(n) {
      currentTrack = n;
      buildTrackList();
    }
    function copyLyrics() {
      if(!currentLyrics || !currentLyrics.length) return;
      const text = currentLyrics.map(x=>x.line).join('\n');
      navigator.clipboard.writeText(text);
      alert('–¢–µ–∫—Å—Ç —Å–∫–æ–ø–∏—Ä–æ–≤–∞–Ω!');
    }
    window.addEventListener('keydown', function(e){
      if(!promoPassed) return;
      if(e.key == 'ArrowRight') {showTrack(Math.min(currentTrack+1, config.tracks.length-1));}
      if(e.key == 'ArrowLeft') {showTrack(Math.max(currentTrack-1, 0));}
    });
    window.showTrack = showTrack;

    // ------------ –§–∏–¥–±–µ–∫ (Telegram) --------------
    function openFeedbackModal() {
      document.getElementById('modal-feedback').classList.add('active');
      document.getElementById('feedback-text').value = "";
      document.getElementById('modal-feedback-error').innerText = "";
      document.getElementById('modal-feedback-success').innerText = "";
      document.getElementById('feedback-text').placeholder="–í–∞—à–µ —Å–æ–æ–±—â–µ–Ω–∏–µ...";
      document.getElementById('feedback-text').disabled = false;
      document.getElementById('send-feedback-btn').disabled = false;
    }
    function closeFeedbackModal() {
      document.getElementById('modal-feedback').classList.remove('active');
    }
    // placeholder-–ø—Ä–µ–≤—Ä–∞—â–µ–Ω–∏–µ
    document.addEventListener('DOMContentLoaded',function(){
      document.getElementById('feedback-link').onclick = openFeedbackModal;
      document.getElementById('modal-feedback').onclick = function(e){
        if(e.target === this) closeFeedbackModal();
      };
      document.getElementById('feedback-text').addEventListener('focus', function(){
        this.placeholder = "";
      });
      document.getElementById('feedback-text').addEventListener('blur', function(){
        if(!this.value) this.placeholder = "–í–∞—à–µ —Å–æ–æ–±—â–µ–Ω–∏–µ...";
      });
      document.getElementById('feedback-text').addEventListener('input', function(){
        if(this.value.length > 200)
          this.value = this.value.substr(0,200);
      });
    });
    // –û—Ç–ø—Ä–∞–≤–∫–∞ —Å–æ–æ–±—â–µ–Ω–∏—è –±–æ—Ç—É
    function sendFeedbackMsg() {
      const textarea = document.getElementById('feedback-text');
      const errorDiv = document.getElementById('modal-feedback-error');
      const successDiv = document.getElementById('modal-feedback-success');
      errorDiv.innerText = "";
      successDiv.innerText = "";

      let msg = textarea.value.trim();
      if(msg.length < 5) {
        errorDiv.innerText = "–ù–∞–ø–∏—à–∏—Ç–µ —Ö–æ—Ç—è –±—ã –ø–∞—Ä—É —Å–ª–æ–≤!";
        return;
      }
      textarea.disabled = true;
      document.getElementById('send-feedback-btn').disabled = true;

      // –§–æ—Ä–º–∏—Ä—É–µ–º –º–µ—Ç–∫—É —Ä–µ–ø–æ –∏ –∞–ª—å–±–æ–º–∞
      let repo = (window.location.pathname.split('/')[2]||'').replace('-', ' ');
      let album = config.albumTitle ? config.albumTitle : '';

      let text = `üí¨ [–û–±—Ä–∞—Ç–Ω–∞—è–°–≤—è–∑—å]\n–†–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–π: ${repo}\n–ê–ª—å–±–æ–º: ${album}\n\n–°–æ–æ–±—â–µ–Ω–∏–µ:\n${msg}`;
      // Send to Bot
      fetch(`https://api.telegram.org/bot${tgBotToken}/sendMessage`, {
        method: 'POST',
        headers: {'Content-Type': 'application/json'},
        body: JSON.stringify({
          chat_id: tgUserId,
          text: text
        })
      })
      .then(r => r.json()).then(resp => {
        if(resp.ok){
          successDiv.innerText = "–°–ø–∞—Å–∏–±–æ! –í–∞—à–µ —Å–æ–æ–±—â–µ–Ω–∏–µ –ø–æ–ª—É—á–µ–Ω–æ.";
          setTimeout(closeFeedbackModal, 2000);
        } else {
          errorDiv.innerText = "–û—à–∏–±–∫–∞ –æ—Ç–ø—Ä–∞–≤–∫–∏, –ø–æ–ø—Ä–æ–±—É–π—Ç–µ –ø–æ–∑–∂–µ.";
        }
        textarea.disabled = false;
        document.getElementById('send-feedback-btn').disabled = false;
      }).catch(()=>{
        errorDiv.innerText = "–û—à–∏–±–∫–∞ —Å–æ–µ–¥–∏–Ω–µ–Ω–∏—è!";
        textarea.disabled = false;
        document.getElementById('send-feedback-btn').disabled = false;
      });
    }
  </script>
</body>
</html>
